<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Summarizing Data Tutorial - Louisiana Mortality File – HPAM 7660 - Health Policy Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../img/site_icon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-76f62414ac3b9a923bd65cbefbe841aa.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">HPAM 7660 - Health Policy Analysis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../syllabus.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../schedule.html"> 
<span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resources/index.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#refining-our-analyic-sample" id="toc-refining-our-analyic-sample" class="nav-link active" data-scroll-target="#refining-our-analyic-sample">Refining our Analyic Sample</a>
  <ul class="collapse">
  <li><a href="#age-adjusted-cancer-mortality-rates" id="toc-age-adjusted-cancer-mortality-rates" class="nav-link" data-scroll-target="#age-adjusted-cancer-mortality-rates">Age-Adjusted Cancer Mortality Rates</a></li>
  <li><a href="#aggregating-to-the-parish-level" id="toc-aggregating-to-the-parish-level" class="nav-link" data-scroll-target="#aggregating-to-the-parish-level">Aggregating to the Parish Level</a></li>
  <li><a href="#merging-population-data" id="toc-merging-population-data" class="nav-link" data-scroll-target="#merging-population-data">Merging Population Data</a></li>
  <li><a href="#calculating-age-adjusted-cancer-mortality-rates" id="toc-calculating-age-adjusted-cancer-mortality-rates" class="nav-link" data-scroll-target="#calculating-age-adjusted-cancer-mortality-rates">Calculating Age-Adjusted Cancer Mortality Rates</a></li>
  <li><a href="#weighting-by-parish-population" id="toc-weighting-by-parish-population" class="nav-link" data-scroll-target="#weighting-by-parish-population">Weighting by Parish Population</a></li>
  <li><a href="#comparing-age-adjusted-cancer-mortality-rates" id="toc-comparing-age-adjusted-cancer-mortality-rates" class="nav-link" data-scroll-target="#comparing-age-adjusted-cancer-mortality-rates">Comparing Age-Adjusted Cancer Mortality Rates</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Summarizing Data Tutorial - Louisiana Mortality File</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="refining-our-analyic-sample" class="level2">
<h2 class="anchored" data-anchor-id="refining-our-analyic-sample">Refining our Analyic Sample</h2>
<p>In the previous tutorial, we calculated crude cancer mortality rates across Louisiana parishes from 2005 through 2019. Now we’ll refine our method for calculating those rates by adjusting for different age distributions across parishes and over time.</p>
<p>It’s important to age-adjust our mortality rates because different parishes have different age profiles and that could bias our estimated rates. For example, suppose that parish A has a relatively high proportion of older people and parish B has a relatively high proportion of younger people. Crude cancer mortality rates would likely show higher rates among parish A than parish B. However, this may not actually be the case once we account for the fact that the older population in parish A is more prone to cancer.</p>
<p>Age-adjustment is really a way to determine how cancer mortality rates would differ between parish A and parish B if both parishes had the same population age distribution.</p>
<p>Let’s start by opening the .Rproj file in your <code>hpam7660_Cancer_Alley</code> folder. Then open the Markdown document you used in the previous tutorial to create the analytic sample. We can continue working off of this same Markdown document as we refine our sample in this tutorial.</p>
<section id="age-adjusted-cancer-mortality-rates" class="level3">
<h3 class="anchored" data-anchor-id="age-adjusted-cancer-mortality-rates">Age-Adjusted Cancer Mortality Rates</h3>
<p>To calculate age-adjusted cancer mortality rates, we need to generate cancer death counts by parish and year for each age group in our data. Start by reading in the raw Louisiana cancer mortality file (you may be able to skip this step if the <code>la_mort</code> data frame is still loaded in your project environment).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>la_mort <span class="ot">&lt;-</span> </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(<span class="st">"https://www.dropbox.com/scl/fi/fzsnhfd3lq80v2o3sag6c/la_mort.csv?rlkey=h1vyjm2b8ppgejgsg3e8evm7i&amp;dl=1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now need to repeat a couple of steps that we’ve seen before. First, we’ll create an indicator for whether a parish is in Cancer Alley:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>la_mort<span class="sc">$</span>cancer_parish <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(la_mort<span class="sc">$</span>cntyrsd <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">33</span>, <span class="dv">47</span>, <span class="dv">51</span>, <span class="dv">71</span>, <span class="dv">89</span>, <span class="dv">93</span>, <span class="dv">95</span>, <span class="dv">121</span>), <span class="dv">1</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we’ll create an indicator for a cancer death:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>la_mort<span class="sc">$</span>cancer39 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(la_mort<span class="sc">$</span>ucr39 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">15</span>), <span class="dv">1</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we need to aggregate to the parish level like we did before, but with one important difference - we need to create age-specific counts of parish-level cancer deaths. To do so, we need to assign people in the mortality file to these age groups using the <code>age</code> variable. But remember, the <code>age</code> variable in the mortality file uses some strange values (refer to the codebook you created for specifics). First we’ll need to replace values of the <code>age</code> variable with age in years. Use the following code to do so:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>la_mort_age <span class="ot">&lt;-</span> la_mort <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">!=</span> <span class="dv">9999</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>la_mort_age<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(la_mort_age<span class="sc">$</span>age <span class="sc">&lt;</span> <span class="dv">2000</span>, la_mort_age<span class="sc">$</span>age <span class="sc">-</span> <span class="dv">1000</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are a few people for whom age in the <code>la_mort</code> file is missing and coded 9999. First, we’re dropping those people from the data by creating a new data frame called <code>la_mort_age</code> where anyone with an age equal to 9999 is excluded. The next line tells R to replace the <code>age</code> variable with values equal to the current value minus 1000 if the current value is less than 2000. Remember that a leading digit of 1 in this variable indicates that age is recorded in years and the remaining three digits are age in years. So by subtracting 1000, we’re left with age in years for those whose age was recorded in years (confusing I know!). Everyone with a leading digit between 2 and 9 died before they turned 1 year old and so their age is measured in months, days, etc. Here we’re telling R to change all those values to 0 since we only want age measured in years.</p>
<p>Now that we have the ages for all individuals in our data represented as age in years, we can categorize ages based on the categories available in the denominator file, which are as follows:</p>
<p>0 to 4<br>
5 to 9<br>
10 to 14<br>
15 to 19<br>
20 to 24<br>
25 to 29<br>
30 to 34<br>
35 to 39<br>
40 to 44<br>
45 to 49<br>
50 to 54<br>
55 to 59<br>
60 to 64<br>
65 to 69<br>
70 to 74<br>
75 to 79<br>
80 to 84<br>
85 and above<br>
</p>
<p>Here’s the R code that will allow us to do that:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>age_breaks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">35</span>, <span class="dv">40</span>, <span class="dv">45</span>, <span class="dv">50</span>, <span class="dv">55</span>, <span class="dv">60</span>, <span class="dv">65</span>, <span class="dv">70</span>, <span class="dv">75</span>, <span class="dv">80</span>, <span class="dv">85</span>, <span class="cn">Inf</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>age_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"0_4"</span>, <span class="st">"5_9"</span>, <span class="st">"10_14"</span>, <span class="st">"15_19"</span>, <span class="st">"20_24"</span>, <span class="st">"25_29"</span>, <span class="st">"30_34"</span>, <span class="st">"35_39"</span>, </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                <span class="st">"40_44"</span>, <span class="st">"45_49"</span>, <span class="st">"50_54"</span>, <span class="st">"55_59"</span>, <span class="st">"60_64"</span>, <span class="st">"65_69"</span>, <span class="st">"70_74"</span>, </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                <span class="st">"75_79"</span>, <span class="st">"80_84"</span>, <span class="st">"85+"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>la_mort_age<span class="sc">$</span>agegrp <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">cut</span>(la_mort_age<span class="sc">$</span>age, <span class="at">breaks =</span> age_breaks, <span class="at">labels =</span> age_labels, <span class="at">right =</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The first line in this code is telling R to define a vector called <code>age_breaks</code> where the “break” corresponds to the lower bound for each age group (e.g., 0 for 0 to 4, 5 for 5 to 9, etc.). The second line is defining values for each age category. Note that I’ve defined these values so that they correspond exactly to the values in the denominator file (<code>la_pop</code>). Finally, the third line is creating a new variable in the <code>la_mort_age</code> data frame called <code>agegrp</code> using the <code>cut</code> function that categorizes the numerical <code>age</code> variable into discrete intervals. Here, the discrete intervals are defined by the values in the <code>age_breaks</code> vector and labeled using the values in the <code>age_labels</code> vector. The <code>right = FALSE</code> option tells R to exclude the next break age from the current age interval (e.g., exclude 5 from the 0-5 interval, exclude 10 from the 5-10 interval, and so on). Also, note that I called this new variable <code>agegrp</code> and created it as a character variable so that it would match the name and variable type of the <code>agegrp</code> variable in the <code>la_pop</code> data. This is because we’ll use <code>agegrp</code> as a key variable when we’re joining the two data frames.</p>
</section>
<section id="aggregating-to-the-parish-level" class="level3">
<h3 class="anchored" data-anchor-id="aggregating-to-the-parish-level">Aggregating to the Parish Level</h3>
<p>Last time, when we aggregated to the parish level, we used the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>parish_count <span class="ot">&lt;-</span> la_mort <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cntyrsd, cancer_parish, year) <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">cancer39 =</span> <span class="fu">sum</span>(cancer39, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you remember, this code created a data frame that included the overall count of cancer deaths by parish and year, but did not differentiate by age. Let’s modify this code so that we aggregate to the parish-age-year level instead of just the parish-year level. To do so, we’ll just need to add <code>agegrp</code> to our <code>group_by</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>parish_count_age <span class="ot">&lt;-</span> la_mort_age <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cntyrsd, cancer_parish, agegrp, year) <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">cancer39 =</span> <span class="fu">sum</span>(cancer39, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After running this, you should see that the <code>parish_count_age</code> data frame contains counts of cancer deaths for each age category we defined above at the parish-year level.</p>
</section>
<section id="merging-population-data" class="level3">
<h3 class="anchored" data-anchor-id="merging-population-data">Merging Population Data</h3>
<p>Now it’s time to join the <code>parish_count_age</code> data frame that we just created with the <code>la_pop</code> data frame that contains our population denominators. First, load the <code>la_pop</code> data if it’s not already in your project environment:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>la_pop <span class="ot">&lt;-</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(<span class="st">"https://www.dropbox.com/scl/fi/650k1obpczky6bwa19ex6/la_county_pop.csv?rlkey=0aokd9m76q7mxwus97uslsx7g&amp;dl=1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Remember that last time, we changed the key variable names in the the cancer count data to match the names in the population data (e.g., <code>cntyrsd</code> became <code>county</code>). This time, we’ll run the join with the different key variable names so you can see what that looks like.</p>
<p>Here’s the code we used last time to do the join:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>la_joined <span class="ot">&lt;-</span> parish_count <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(la_pop, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"county"</span>, <span class="st">"year"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’ll modify that code this time to account for the different key variable names (<code>cntyrsd</code> and <code>county</code>) and because we now have a new key variable to include: <code>agegrp</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>la_joined <span class="ot">&lt;-</span> parish_count_age <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(la_pop, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"cntyrsd"</span> <span class="ot">=</span> <span class="st">"county"</span>, <span class="st">"year"</span>, <span class="st">"agegrp"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This code tells R that we want to create a new data frame called <code>la_joined</code> that is formed using an <code>inner_join</code> on the <code>parish_count_age</code> and <code>la_pop</code> data frames. They key variables for R to join on are county (which is called <code>cntyrsd</code> in the <code>parish_count_age</code> data frame and called <code>county</code> in the <code>la_pop</code> data frame), year, and age group.</p>
<p>If you take a look at the new <code>la_joined</code> data frame, you’ll see that we have cancer death counts and population counts for each age in each parish-year. We also have population counts by age-race-ethnicity, which we’ll use later on.</p>
</section>
<section id="calculating-age-adjusted-cancer-mortality-rates" class="level3">
<h3 class="anchored" data-anchor-id="calculating-age-adjusted-cancer-mortality-rates">Calculating Age-Adjusted Cancer Mortality Rates</h3>
<p>The process of age-adjusting parish cancer mortality rates consists of standardizing age distributions so that when comparing cancer mortality across parish or over time, we’re comparing mortality rates for people who are the “same age” (in a statistical sense). Standardizing age distributions involves choosing a reference population and calculating weighted mortality rates based on that population. Let’s walk through how this is done.</p>
<p><strong>STANDARD POPULATION</strong></p>
<p>First we need to choose a standard population age distribution. Most commonly, people use the age distribution in the U.S. at the time of the 2000 census.</p>
<table class="table">
<caption><em>Source:</em> https://seer.cancer.gov/stdpopulations/stdpop.19ages.html</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Age</th>
<th style="text-align: left;">2000 U.S. Standard (in millions)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0 to 4</td>
<td style="text-align: left;">69,135</td>
</tr>
<tr class="even">
<td style="text-align: left;">5 to 9</td>
<td style="text-align: left;">72,533</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10 to 14</td>
<td style="text-align: left;">73,032</td>
</tr>
<tr class="even">
<td style="text-align: left;">15 to 19</td>
<td style="text-align: left;">72,169</td>
</tr>
<tr class="odd">
<td style="text-align: left;">20 to 24</td>
<td style="text-align: left;">66,478</td>
</tr>
<tr class="even">
<td style="text-align: left;">25 to 29</td>
<td style="text-align: left;">64,529</td>
</tr>
<tr class="odd">
<td style="text-align: left;">30 to 34</td>
<td style="text-align: left;">71,044</td>
</tr>
<tr class="even">
<td style="text-align: left;">35 to 39</td>
<td style="text-align: left;">80,762</td>
</tr>
<tr class="odd">
<td style="text-align: left;">40 to 44</td>
<td style="text-align: left;">81,851</td>
</tr>
<tr class="even">
<td style="text-align: left;">45 to 49</td>
<td style="text-align: left;">72,118</td>
</tr>
<tr class="odd">
<td style="text-align: left;">50 to 54</td>
<td style="text-align: left;">62,716</td>
</tr>
<tr class="even">
<td style="text-align: left;">55 to 59</td>
<td style="text-align: left;">48,454</td>
</tr>
<tr class="odd">
<td style="text-align: left;">60 to 64</td>
<td style="text-align: left;">38,793</td>
</tr>
<tr class="even">
<td style="text-align: left;">65 to 69</td>
<td style="text-align: left;">34,264</td>
</tr>
<tr class="odd">
<td style="text-align: left;">70 to 74</td>
<td style="text-align: left;">31,773</td>
</tr>
<tr class="even">
<td style="text-align: left;">75 to 79</td>
<td style="text-align: left;">26,999</td>
</tr>
<tr class="odd">
<td style="text-align: left;">80 to 84</td>
<td style="text-align: left;">17,842</td>
</tr>
<tr class="even">
<td style="text-align: left;">85+</td>
<td style="text-align: left;">15,508</td>
</tr>
</tbody>
</table>
<p>Here’s a .csv file of the standard population age distribution. Read it into R and join it with your <code>la_joined</code> data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>stnrd_pop <span class="ot">&lt;-</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(<span class="st">"https://www.dropbox.com/scl/fi/xzd2o5lza237so6vamqwb/stnrd_pop.csv?rlkey=zp90au2tuq6eptvi1yiyjfzua&amp;dl=1"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>la_joined_stnrd <span class="ot">&lt;-</span> la_joined <span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(stnrd_pop, <span class="at">by =</span> <span class="st">"agegrp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that this code uses an <code>inner_join</code> command on the key variable <code>agegrp</code>. Both the <code>la_joined</code> and <code>stnrd_pop</code> data frames contain age ranges and so this join statement will add the standard population column in the table above to our <code>la_joined</code> data frame.</p>
<p><strong>STANDARD POPULATION WEIGHTS</strong></p>
<p>Now that we have the standard population age distribution, we need to use this information to create population weights. The idea here is that we calculate the share of the total population represented by each age group. We’ll then multiply this share by the age-specific cancer mortality rates we calculated above.</p>
<p>Run the following code to calculate the population weights:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>la_joined_stnrd<span class="sc">$</span>stnrd_pop_weight <span class="ot">&lt;-</span> (la_joined_stnrd<span class="sc">$</span>stnrd_pop) <span class="sc">/</span> (<span class="fu">sum</span>(stnrd_pop<span class="sc">$</span>stnrd_pop))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This code creates a new variable called <code>stnrd_pop_weight</code> that is calculated as the age-specific standard population divided by the total standard population. In other words, the value of this <code>stnrd_pop_weight</code> variable is each age group’s share of the total population.</p>
<p><strong>APPLYING STANDARD POPULAION WEIGHTS</strong></p>
<p>Now we want to multiply the age-specific cancer mortality rates (that we actually haven’t created yet in this tutorial) by this new <code>stnrd_pop_weight</code> variable. In the last tutorial, we calculated cancer mortality rates by dividing the total count of cancer deaths by the total population in each parish and then multiplied by 100,000 so that rates were per 100,000 population. We’ll do the same thing here, but this time rates will be age-specific and we’ll multiply the rates by the <code>stnrd_pop_weight</code> variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>la_joined_stnrd<span class="sc">$</span>cancer_rate_adj <span class="ot">&lt;-</span> ((la_joined_stnrd<span class="sc">$</span>cancer39) <span class="sc">/</span> (la_joined_stnrd<span class="sc">$</span>tot_pop <span class="sc">/</span> <span class="dv">100000</span>)) <span class="sc">*</span> la_joined_stnrd<span class="sc">$</span>stnrd_pop_weight</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This code tells R to create a new variable called <code>cancer_rate_adj</code> that is equal to the count of cancer deaths <code>cancer39</code> divided by the total population <code>tot_pop</code> (which has been divided by 100,000) and multiplied by the <code>stnrd_pop_weight</code> variable. However, the big difference between what we’re doing this time and what we did in the last tutorial is that the rows in our <code>la_joined_stnrd</code> data frame represent <strong><em>age-specific</em></strong> cancer death counts and populations and not <strong><em>overall counts</em></strong> at the parish level.</p>
<p><strong>AGGREGATE OVER AGE</strong></p>
<p>Our goal here is to calculate a single age-adjusted cancer mortality rate for each parish in each year. Now that we’ve calculated cancer mortality rates for each age group in each parish-year, we just need to aggregate over those age groups to get the age-adjusted parish level cancer mortality rate. We can do that as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>parish_rates <span class="ot">&lt;-</span> la_joined_stnrd <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cntyrsd, cancer_parish, year) <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">cancer_rate_adj =</span> <span class="fu">sum</span>(cancer_rate_adj, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">cancer39 =</span> <span class="fu">sum</span>(cancer39), <span class="at">tot_pop =</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">sum</span>(tot_pop))</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>parish_rates<span class="sc">$</span>cancer_rate_crude <span class="ot">&lt;-</span> (parish_rates<span class="sc">$</span>cancer39) <span class="sc">/</span> (parish_rates<span class="sc">$</span>tot_pop <span class="sc">/</span> <span class="dv">100000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This code creates a new data frame called <code>parish_rates</code> that contains aggregated cancer morality rates (<code>cancer_rate_adj</code>) by parish-year. I’ve also included columns for the total count of cancer deaths in that parish-year and the total population in that parish-year. We’ll use those columns shortly. Finally, notice that the last line in the code chunk above creates a variable called <code>cancer_rate_crude</code>. This is just the non-age-adjusted parish cancer mortality rate that we calculated in the last tutorial.</p>
<p>This step may be particularly confusing, so if there’s one way to wrap your head around what’s happening here, it’s this: values in the <code>la_joined_stnrd</code> data frame rows were measured at the age-parish-year level, while values in the <code>parish_rates</code> data frame are measured at the parish-year level.</p>
<p>Let’s take a look at differences between crude and adjusted cancer rates. We can recreate the table of 2019 cancer rates that we made at the end of the last tutorial. Here was the code we used:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>parish_cancer_2019 <span class="ot">&lt;-</span> <span class="fu">subset</span>(la_joined_all, year <span class="sc">==</span> <span class="dv">2019</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(parish_cancer_2019[, <span class="fu">c</span>(<span class="st">"county"</span>, <span class="st">"cancer_rate_total"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s modify this code to include the adjusted rate and change the names to reflect our new data frame names:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>parish_cancer_2019 <span class="ot">&lt;-</span> <span class="fu">subset</span>(parish_rates, year <span class="sc">==</span> <span class="dv">2019</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(parish_cancer_2019[, <span class="fu">c</span>(<span class="st">"cntyrsd"</span>, <span class="st">"cancer_rate_crude"</span>, <span class="st">"cancer_rate_adj"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="weighting-by-parish-population" class="level3">
<h3 class="anchored" data-anchor-id="weighting-by-parish-population">Weighting by Parish Population</h3>
<p>You’ll notice there are some big differences between some of the crude and age-adjusted cancer mortality rates. This tends to happen when a parish’s population (and hence the number of cancer deaths in that parish is small). We’ll want to account for this before we compare cancer mortality rates for Cancer Alley and non-Cancer Alley parishes. We can do this by weighting our aggregated (Cancer Alley vs.&nbsp;non-Cancer Alley) means by parish populations. In other words, when comparing a single “Cancer Alley mortality rate” to a single “Non-Cancer Alley mortality rate”, these rates are comprised of an average of rates for each parish in each grouping. But we’d like the more populous parishes in those groupings to contribute <em>more</em> to the overall average mortality rate rather than weighting each parish equally.</p>
<p>We can create population weights (different from standard population weights) by first multiplying our age-adjusted parish cancer mortality rates by the total parish population, adding up each of those values for all the Cancer Alley parishes and the non-Cancer Alley parishes separately, and then dividing the sum of those values by the total population in Cancer Alley and non-Cancer Alley parishes (kind of confusing, I know). Here’s the code to do that:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>parish_rates<span class="sc">$</span>pop_weight <span class="ot">&lt;-</span> (parish_rates<span class="sc">$</span>cancer_rate_adj) <span class="sc">*</span> (parish_rates<span class="sc">$</span>tot_pop)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>cancer_alley_rates <span class="ot">&lt;-</span> parish_rates <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cancer_parish, year) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">cancer_rate_adj_wt =</span> <span class="fu">sum</span>(pop_weight) <span class="sc">/</span> <span class="fu">sum</span>(tot_pop))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The first line of the code creates a new variable in the <code>parish_rates</code> data frame called <code>pop_weight</code> that is equal to the product of each parish’s age-adjusted cancer mortality rate (<code>cancer_rate_adj</code>) and that parish’s total population (<code>tot_pop</code>). The rest of the code sums up these values over Cancer Alley and non-Cancer Alley parishes and divides the weighted mortality rates by the total population in each group.</p>
</section>
<section id="comparing-age-adjusted-cancer-mortality-rates" class="level3">
<h3 class="anchored" data-anchor-id="comparing-age-adjusted-cancer-mortality-rates">Comparing Age-Adjusted Cancer Mortality Rates</h3>
<p>Now that we have our age-adjusted and population-weighted parish cancer mortality rates, we can create a table to compare annual cancer mortality rates for Cancer Alley and non-Cancer Alley parishes. Just like we did before, let’s use the <code>kable</code> command to create the table:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(cancer_alley_rates)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is ok, but it would be much easier to read this table if we had a column of cancer mortality rates for Cancer Alley parishes and a separate column of cancer mortality rates for non-Cancer Alley Parishes. To get there, we can split the <code>cancer_alley_rates</code> data frame by the <code>cancer_parish</code> indicator and then join the two data frames back together:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>cancer_alley <span class="ot">&lt;-</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(cancer_alley_rates, cancer_parish <span class="sc">==</span> <span class="dv">1</span>, <span class="at">select =</span> <span class="fu">c</span>(cancer_rate_adj_wt, year)) <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">cancer_alley_rate =</span> cancer_rate_adj_wt)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>no_cancer_alley <span class="ot">&lt;-</span> </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(cancer_alley_rates, cancer_parish <span class="sc">==</span> <span class="dv">0</span>, <span class="at">select =</span> <span class="fu">c</span>(cancer_rate_adj_wt, year)) <span class="sc">%&gt;%</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">no_cancer_alley_rate =</span> cancer_rate_adj_wt)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>cancer_alley_table <span class="ot">&lt;-</span> cancer_alley <span class="sc">%&gt;%</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(no_cancer_alley, <span class="at">by =</span> <span class="st">"year"</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>cancer_alley_table <span class="ot">&lt;-</span> cancer_alley_table[,<span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"cancer_alley_rate"</span>, <span class="st">"no_cancer_alley_rate"</span>)]</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(cancer_alley_table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This looks much better and provides a nice way to summarize age-adjusted, population weighted, cancer mortality rates for Cancer Alley and non-Cancer Alley parishes. In the next tutorial, we’ll refine our definition of Cancer Alley parishes and run some subgroup analyses that will allow us to examine cancer mortality rates by cancer type and by race and ethnicity.</p>
<p>Be sure to save your Markdown file and push the file to your <code>hpam7660_Cancer_Alley</code> GitHub repo.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/hpam7660\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>