<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.552">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>HPAM 7660 - Health Policy Analysis - Data Wrangling Tutorial - Louisiana Mortality File</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../img/site_icon.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">HPAM 7660 - Health Policy Analysis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../syllabus.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../schedule.html"> 
<span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../resources/index.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#analyic-sample-construction" id="toc-analyic-sample-construction" class="nav-link active" data-scroll-target="#analyic-sample-construction">Analyic Sample Construction</a>
  <ul class="collapse">
  <li><a href="#loading-the-louisiana-mortality-files" id="toc-loading-the-louisiana-mortality-files" class="nav-link" data-scroll-target="#loading-the-louisiana-mortality-files">Loading the Louisiana Mortality Files</a></li>
  <li><a href="#defining-cancer-alley-parishes" id="toc-defining-cancer-alley-parishes" class="nav-link" data-scroll-target="#defining-cancer-alley-parishes">Defining Cancer Alley Parishes</a></li>
  <li><a href="#identifying-cancer-deaths" id="toc-identifying-cancer-deaths" class="nav-link" data-scroll-target="#identifying-cancer-deaths">Identifying Cancer Deaths</a></li>
  <li><a href="#aggregating-to-the-parish-level" id="toc-aggregating-to-the-parish-level" class="nav-link" data-scroll-target="#aggregating-to-the-parish-level">Aggregating to the Parish Level</a></li>
  <li><a href="#merging-population-data" id="toc-merging-population-data" class="nav-link" data-scroll-target="#merging-population-data">Merging Population Data</a></li>
  <li><a href="#calculating-cancer-mortality-rates" id="toc-calculating-cancer-mortality-rates" class="nav-link" data-scroll-target="#calculating-cancer-mortality-rates">Calculating Cancer Mortality Rates</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data Wrangling Tutorial - Louisiana Mortality File</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="analyic-sample-construction" class="level2">
<h2 class="anchored" data-anchor-id="analyic-sample-construction">Analyic Sample Construction</h2>
<p>In this tutorial, we’ll construct an analytic sample from the Louisiana Mortality file so that we can analyze cancer mortality rates in Cancer Alley parishes.</p>
<p>Before beginning the tutorial, open the RStudio project file (.Rproj) you saved for the previous tutorial (this is the project that you used when you created your “Louisiana Mortality Data Description” Markdown document). Note that this project file is already linked to your <code>hpam7660_Cancer_Alley</code> GitHub repo. From now on, we’ll save all work related to the Cancer Alley scenario to this same GitHub repo.</p>
<p>Next, open a new Markdown document and give it a YAML header that includes the title “Louisiana Mortality Analytic Sample”, your name, the date, and “pdf_document” as the output format.</p>
<section id="loading-the-louisiana-mortality-files" class="level3">
<h3 class="anchored" data-anchor-id="loading-the-louisiana-mortality-files">Loading the Louisiana Mortality Files</h3>
<p>Just like we did in the previous tutorial, you’ll want to first load the Louisiana Mortality File. Include the following R code in your Markdown document.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>la_mort <span class="ot">&lt;-</span> </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(<span class="st">"https://www.dropbox.com/scl/fi/fzsnhfd3lq80v2o3sag6c/la_mort.csv?rlkey=h1vyjm2b8ppgejgsg3e8evm7i&amp;dl=1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="defining-cancer-alley-parishes" class="level3">
<h3 class="anchored" data-anchor-id="defining-cancer-alley-parishes">Defining Cancer Alley Parishes</h3>
<p><img src="../img/cancer_parish.png" class="img-fluid" alt="cancer alley parishes"></p>
<p>Cancer Alley is typically defined as an 85-mile stretch along the Mississippi river where a high concentration of petrochemical plants are located. These plants are known to emit toxic chemicals, including ethylene oxide, which is a proven carcinogen. The parishes comprising Cancer Alley include: Ascension, East Baton Rouge, Iberville, Jefferson, Orleans, St.&nbsp;Charles, St.&nbsp;James, St.&nbsp;John the Baptist, and West Baton Rouge.</p>
<p>To determine whether cancer mortality tends to be elevated in Cancer Alley parishes, we first need to define a new variable that identifies Cancer Alley parishes. We can create this identifier using the following R code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>la_mort<span class="sc">$</span>cancer_parish <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(la_mort<span class="sc">$</span>cntyrsd <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">33</span>, <span class="dv">47</span>, <span class="dv">51</span>, <span class="dv">71</span>, <span class="dv">89</span>, <span class="dv">93</span>, <span class="dv">95</span>, <span class="dv">121</span>), <span class="dv">1</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we’re telling R to create a new variable in the <code>la_mort</code> data set called <code>cancer_parish</code>. The way to read the code on the right hand side of the <code>&lt;-</code> symbol is as follows: “If county of residence was equal to 5, 33, 47, 51, 71, 89, 93, 95, or 121, the cancer_parish variable should take the value of 1, otherwise the cancer_parish variable should take the value of 0.”</p>
<p>You’re probably wondering what the numbers 5, 33, 47, 51, 71, 89, 93, 95, and 121 mean. These are county FIPS codes. Each county in the U.S. is given a unique code. In our case, these codes represent the following parishes:</p>
<ul>
<li>5 - Ascension</li>
<li>33 - East Baton Rouge</li>
<li>47 - Iberville</li>
<li>51 - Jefferson</li>
<li>71 - Orleans</li>
<li>89 - St.&nbsp;Charles</li>
<li>93 - St.&nbsp;James</li>
<li>95 - St.&nbsp;John the Baptist</li>
<li>121 - West Baton Rouge</li>
</ul>
<p>Let’s check the new variable we created to make sure that it defines the correct parishes as belonging to Cancer Alley. We can use the following R code to double check our work:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(la_mort<span class="sc">$</span>cancer_parish)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(la_mort<span class="sc">$</span>cntyrsd[la_mort<span class="sc">$</span>cancer_parish <span class="sc">==</span> <span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The first <code>table</code> command shows us that our new <code>cancer_parish</code> variable has 445,138 rows where the value is equal to 0 and 197,558 rows where the value is equal to 1. That means that, of the 642,696 rows (i.e., deaths) in our data, a little more than 30% represent people who lived in a Cancer Alley parish.</p>
<p>The second <code>table</code> command shows us the parish FIPS code values that correspond to a <code>cancer_parish</code> value of 1. We can see that the parish values exactly match the FIPS codes for Cancer Alley parishes, so our code worked as intended. Had we mistyped a parish FIPS code in our <code>ifelse</code> command, we would see the mistake here and could correct it.</p>
</section>
<section id="identifying-cancer-deaths" class="level3">
<h3 class="anchored" data-anchor-id="identifying-cancer-deaths">Identifying Cancer Deaths</h3>
<p>Now that we have created a variable to categorize Cancer Alley parishes, we need to identify which deaths in the Louisiana Mortality File were due to cancer. As you know from the previous tutorial, the death certificate data contain four levels of “cause of death” codes. The most granular level is the <code>ucod</code> variable, which includes ICD 10 codes. The <code>ucr358</code> variable aggregates these ICD 10 codes into 358 separate cause of death categories. Similarly, the <code>ucr113</code> and <code>ucr39</code> variables aggregate the ICD 10 codes into 113 and 39 separate cause of death categories, respectively.</p>
<p>Let’s start with the most aggregate level of cause of death codes and work our way down from there to see whether it matters which categorization scheme we use. Similar to what we did with Cancer Alley parishes, we want to create a variable that identifies cancer deaths using the <code>ucr39</code> variable. Here’s the R code we can use to do that:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>la_mort<span class="sc">$</span>cancer39 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(la_mort<span class="sc">$</span>ucr39 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">14</span>, <span class="dv">15</span>), <span class="dv">1</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Run the following <code>table</code> command to see how many cancer deaths are included in the data when we define a cancer death using the <code>ucr39</code> variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(la_mort<span class="sc">$</span>cancer39)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You should see that, according to the <code>ucr39</code> classification, 138,677 people in the data died from cancer and 504,019 died from non-cancer causes.</p>
<p>One thing to notice about the <code>c()</code> vector in our <code>ifelse</code> command is that the numbers corresponding to cancer deaths are sequential - that is they go from 5 to 15 in units of 1. Because of this, we could express our <code>ifelse</code> statement more succinctly as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>la_mort<span class="sc">$</span>cancer39 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(la_mort<span class="sc">$</span>ucr39 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">15</span>), <span class="dv">1</span>, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This will give us the exact same result as the previous command, but allows us to avoid typing all the individual cause of death numbers.</p>
<p>Now see what happens if you use the <code>ucr113</code> variable to define cancer deaths. Create a variable called <code>cancer113</code> that uses the <code>ucr113</code> variable and codes 19 through 44 to define cancer deaths. Do you get the same number of cancer deaths that you did when using <code>ucr39</code>?</p>
<p>Spoiler: you do not. Let’s investigate the discrepancy in the coding. First, we know that we have 141,747 cancer deaths when we use <code>ucr113</code> and 138,677 cancer deaths when we use <code>ucr39</code>. That means that 3,070 people who were coded as having died of cancer in the <code>ucr113</code> variable were coded as dying of some other cause in the <code>ucr39</code> variable. Let’s see what those causes are:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(la_mort<span class="sc">$</span>ucr39[la_mort<span class="sc">$</span>cancer113 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> la_mort<span class="sc">$</span>cancer39 <span class="sc">==</span> <span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Turns out all 3,070 people were coded as dying from “all other disease” in the <code>ucr39</code> variable. We can dig a little deeper by examining the ICD 10 codes for these 3,070 people. Run the following R code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(la_mort<span class="sc">$</span>ucod[la_mort<span class="sc">$</span>cancer113 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> la_mort<span class="sc">$</span>cancer39 <span class="sc">==</span> <span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This shows us that all 3,070 people had an ICD 10 cause of death code between D000 and D489. According to the data description, these ICD 10 codes correspond to a category called “in situ neoplasms, benign neoplasms and neoplasms of uncertain or unknown behavior”. Now we can see what’s happening: in situ neoplasms and benign neoplasms are not malignant neoplasms, so these causes of death were not included in our list of cancers when we used <code>ucr39</code> codes. It’s not all that clear whether we should consider “in situ neoplasms, benign neoplasms and neoplasms of uncertain or unknown behavior” to be deaths caused by cancer. To be conservative, let’s exclude those deaths from our <code>cancer113</code> variable. You’ll need to recreate the <code>cancer113</code> variable and exclude code 44. Once you do that, you should find that you get the same number of cancer deaths, 138,677 whether you use <code>ucr39</code> or <code>ucr113</code>.</p>
<p>We’ll skip replicating this exercise using the <code>ucr358</code> variable, but if you try it on your own, you should find that it also gives you 138,677 deaths attributable to malignant cancers.</p>
</section>
<section id="aggregating-to-the-parish-level" class="level3">
<h3 class="anchored" data-anchor-id="aggregating-to-the-parish-level">Aggregating to the Parish Level</h3>
<p>Now that we’ve identified cancer deaths, we’ll want to use this information to build annual parish-specific cancer mortality rates. As the word “rate” implies, we’re going to need to create both a numerator and a denominator. Our numerator should be the count of cancer deaths in each parish by year and our denominator should be parish population. We’ll bring in population measures in the next step, but first, let’s aggregate cancer death counts by parish and year, and that we want to ignore cases where <code>cancer39</code> is missing (though there shouldn’t be any rows where <code>cancer39</code> is missing, we’ll still add this option as a precaution).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>parish_count <span class="ot">&lt;-</span> la_mort <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cntyrsd, cancer_parish, year) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">cancer39 =</span> <span class="fu">sum</span>(cancer39, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It’s worth taking a minute to clearly explain what’s going on here. First, we’re loading the <code>dplyr</code> library because we want to use the <code>group_by</code> command and that command is part of the <code>dplyr</code> package. Next, we’re creating a new data frame called <code>parish_count</code> that is going to be a transformation of the <code>la_mort</code> data frame that we’ve been working with. The last two lines of this code tell R that we want to calculate the sum of the <code>cancer39</code> variable by parish (<code>cntyrsd</code>), cancer alley parishes (<code>cancer_parish</code>), and year.</p>
<p>We can get a sense of what this data aggregation looks like by using the <code>summary</code> command (note that <code>summarize</code> and <code>summary</code> are two different commands):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(parish_count<span class="sc">$</span>cancer39)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The results of the <code>summary</code> command tell us that, on average, there were 144.5 cancer deaths per parish per year. The parish-year grouping with the fewest cancer deaths had 3 deaths and the parish-year grouping with the most cancer deaths had 992 cancer deaths.</p>
<p>We can also take a more complete look at our aggregate data frame by using the <code>View(parish_count)</code> command. Remember that Markdown doesn’t like the <code>View()</code> command, so you’ll want to type this command into the Console Window command line instead of including it in your Markdown document.</p>
</section>
<section id="merging-population-data" class="level3">
<h3 class="anchored" data-anchor-id="merging-population-data">Merging Population Data</h3>
<p>As you know, we have a very rough measure of parish population in the mortality file, but it doesn’t provide the level of precision we need to calculate accurate cancer mortality rates. So we’re going to have to bring in parish-level population data from another source.</p>
<p>First you’ll need to download a data file that contains county population estimates for Louisiana. I’ve created this file using data from the Census. If you’re interested, you can find the raw data <a href="https://www.census.gov/programs-surveys/popest/technical-documentation/research/evaluation-estimates.html">here</a>. Otherwise, you can download the file you’ll need for this project by using the code below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>la_pop <span class="ot">&lt;-</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_csv</span>(<span class="st">"https://www.dropbox.com/scl/fi/650k1obpczky6bwa19ex6/la_county_pop.csv?rlkey=0aokd9m76q7mxwus97uslsx7g&amp;dl=1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>One you read this file into R, you’ll see that there are 24,320 rows and 23 columns. Some of the column names should be displayed in the notes that follow the <code>read_csv</code> command. We’ll go over this population file in more detail in a later class, but you can get some sense of the contents from the column names.</p>
<p>Now we’ll need to use the <code>join</code> command to merge the population data from the <code>la_pop</code> data frame to the <code>parish_count</code> data frame. However, before we can do that, there’s an important modification that we’ll need to make to our data frames. In order to join two different data frames, we need at least one common variable between the data frames. These common variables are called “key variables”. In this case, we’ll have two key variables: county and year. There’s just one problem here - while the <code>year</code> variable has the same name in both the <code>parish_count</code> and <code>la_pop</code> data frames, the <code>county</code> variable does not. In the <code>parish_count</code> data frame, the variable that identifies county is called <code>cntyrsd</code>, while in the <code>la_pop</code> data frame, the variable that identifies county is called <code>county</code>. Let’s change the name of the <code>cntyrsd</code> variable in the <code>parish_count</code> data frame to <code>county</code> so that the key variable names are consistent across the two data frames:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>parish_count <span class="ot">&lt;-</span> parish_count <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">county =</span> cntyrsd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can double check to make sure that the <code>rename</code> command actually worked by typing either <code>parish_count</code> or <code>glimpse(parish_count)</code> into the Console Window command line.</p>
<p>Now that we’ve taken care of the variable name issue, we can join the two data frames:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>la_joined <span class="ot">&lt;-</span> parish_count <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(la_pop, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"county"</span>, <span class="st">"year"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You’ll get more practice with joins and key variables in your next homework assignment, but a quick explanation of what is happening here is that R is merging the columns from the <code>parish_count</code> and <code>la_pop</code> data frames into a single data frame called <code>la_joined</code>. The common columns linking the two data frames are the <code>county</code> and <code>year</code> columns. We use the command <code>inner_join</code> because we only want to keep counties and years that are present in both data frames (e.g., the <code>la_pop</code> data frame contains population estimates for 2020, but we only have data through 2019 in the <code>parish_count</code> data frame). This <a href="https://stackoverflow.com/questions/19267238/what-is-difference-between-inner-join-and-outer-join">page</a> provides a nice description of the different types of joins and very helpful picture.</p>
<p>Note that there is a way to use key variables with different names that avoids the renaming step (you’ll see an example of this in ModernDive chapter 3.7.2), but that can get confusing. For the sake of this tutorial, renaming the key variables so that they share the same names in both data frames is more straightforward.</p>
<p>Take a look at the new <code>la_joined</code> data frame by typing <code>View(la_joined)</code> in the Console Window command line. You should see that the columns from both the <code>parish_count</code> and <code>la_pop</code> data frames are now combined into this new data frame.</p>
</section>
<section id="calculating-cancer-mortality-rates" class="level3">
<h3 class="anchored" data-anchor-id="calculating-cancer-mortality-rates">Calculating Cancer Mortality Rates</h3>
<p>Now that we have a data frame that contains our numerator (cancer deaths by parish and year) and our denominator (parish population by year), we can calculate parish-specific cancer mortality rates. However, one last data modification is required before we do so. If you take a look at either the <code>la_joined</code> or <code>la_pop</code> data frames, you’ll notice that we have population estimates for several different age groups. We’ll calculate age-adjusted cancer mortality rates in an upcoming tutorial. For now, we’ll just calculate crude cancer mortality rates using the entire parish population. Practically, this means we’ll want to delete rows where the <code>agegrp</code> variable is not equal to “all” (you can type <code>table(la_joined$agegrp)</code> to see the different values of the <code>agegrp</code> variable). We’ve seen a couple of different ways to do this in our tutorials and homework assignments. You could use either of the two options below to achieve the same result:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>la_joined_all <span class="ot">&lt;-</span> <span class="fu">subset</span>(la_joined, agegrp <span class="sc">==</span> <span class="st">"all"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>OR</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>la_joined_all <span class="ot">&lt;-</span> la_joined <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(agegrp <span class="sc">==</span> <span class="st">"all"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can double check to make sure the <code>la_joined_all</code> data frame contains only rows where <code>agegrp</code> is equal to “all” by typing <code>table(la_joined_all$agegrp)</code>.</p>
<p>Now it’s pretty easy to calculate parish-level cancer mortality rates by year. We’ll just create a new variable called <code>cancer_rate_total</code> that is the ratio of cancer deaths (<code>cancer39</code>) to population (<code>tot_pop</code>) in each parish in each year.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>la_joined_all<span class="sc">$</span>cancer_rate_total <span class="ot">&lt;-</span> (la_joined_all<span class="sc">$</span>cancer39) <span class="sc">/</span> (la_joined_all<span class="sc">$</span>tot_pop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s use the <code>summary</code> command to take a look at this new variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(la_joined_all<span class="sc">$</span>cancer_rate_total)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You’ll see that these numbers are very small! It’s common to calculate cancer mortality rates as deaths per 100,000 population. Let’s modify our <code>cancer_rate_total</code> variable so that it represents cancer deaths per 100,000 parish population.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>la_joined_all<span class="sc">$</span>cancer_rate_total <span class="ot">&lt;-</span> ((la_joined_all<span class="sc">$</span>cancer39) <span class="sc">/</span> (la_joined_all<span class="sc">$</span>tot_pop <span class="sc">/</span> <span class="dv">100000</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you run the <code>summary</code> command again, you’ll see that the cancer mortality rates we’ve calculated are the same as before, but we’ve moved the decimal place to make the numbers easier to interpret.</p>
<p>Finally, let’s create a simple table of parish-level cancer mortality rates for 2019. We can use the <code>subset</code> and <code>kable</code> commands to create the table as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>parish_cancer_2019 <span class="ot">&lt;-</span> <span class="fu">subset</span>(la_joined_all, year <span class="sc">==</span> <span class="dv">2019</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(parish_cancer_2019[, <span class="fu">c</span>(<span class="st">"county"</span>, <span class="st">"cancer_rate_total"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This doesn’t quite get us to where we want to be yet (i.e., comparing cancer mortality rates for Cancer Alley parishes to the rest of Louisiana), but we now have an analytic data set that we can use to get there.</p>
<p>Be sure to save your Markdown file and push the file to your <code>hpam7660_Cancer_Alley</code> GitHub repo.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/k-callison\.github\.io\/hpam7660-sp24\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>